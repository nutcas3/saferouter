:80 {
	encode gzip zstd
	header {
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "no-referrer-when-downgrade"
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
	}
	
	handle /* {
		reverse_proxy dashboard:3000 {
			health_uri /health
			health_interval 30s
			health_timeout 5s
		}
	}
	
	handle /v1/* {
		reverse_proxy proxy:8080 {
			health_uri /health
			health_interval 30s
			health_timeout 5s
		}
	}
	
	handle /metrics {
		reverse_proxy proxy:8080
	}
	
	handle /prometheus/* {
		uri strip_prefix /prometheus
		reverse_proxy prometheus:9090
	}
	
	handle /grafana/* {
		uri strip_prefix /grafana
		reverse_proxy grafana:3000
	}
	
	log {
		output stdout
		format console
		level INFO
	}
}

# HTTPS configuration (uncomment and configure for production)
# saferoute.io {
# 	encode gzip zstd
# 	
# 	# Let's Encrypt automatic HTTPS
# 	tls your-email@example.com
# 	
# 	# Same handlers as above
# 	handle /* {
# 		reverse_proxy dashboard:3000
# 	}
# 	
# 	handle /v1/* {
# 		reverse_proxy proxy:8080
# 	}
# 	
# 	log {
# 		output file /var/log/caddy/access.log
# 		format json
# 	}
# }
